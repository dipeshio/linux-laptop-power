#!/bin/bash
# ============================================================================
# LAPTOP POWER OPTIMIZER - CONFIGURATION FILE
# ============================================================================
# Gold-standard Watt-per-Performance efficiency for mobile systems
# Optimized for: Intel Alder Lake (i7-1260P), 6.14+ Kernels
# ============================================================================

# ----------------------------------------------------------------------------
# POWER STATE DETECTION
# ----------------------------------------------------------------------------

# Battery percentage threshold for aggressive power saving
LOW_BATTERY_THRESHOLD=20

# Polling interval for battery status (seconds)
BATTERY_POLL_INTERVAL=30

# ----------------------------------------------------------------------------
# CPU GOVERNOR SETTINGS
# ----------------------------------------------------------------------------

# Governor when on AC power
AC_GOVERNOR="performance"

# Governor when on battery
BATTERY_GOVERNOR="powersave"

# Energy Performance Preference on AC
AC_EPP="balance_performance"

# Energy Performance Preference on battery
BATTERY_EPP="power"

# Maximum CPU frequency on AC (kHz) - 3.6GHz
AC_MAX_FREQ=3600000

# Maximum CPU frequency on battery (kHz) - 2.8GHz
BATTERY_MAX_FREQ=2800000

# Minimum CPU frequency (kHz) - 400MHz
MIN_FREQ=400000

# Enable/disable CPU boost (turbo)
AC_TURBO_ENABLED=1
BATTERY_TURBO_ENABLED=1

# ----------------------------------------------------------------------------
# E-CORE MANAGEMENT (Alder Lake Hybrid CPUs)
# ----------------------------------------------------------------------------

# Disable E-cores on battery to save power
# E-cores are typically CPU 8-15 on i7-1260P
DISABLE_ECORES_ON_BATTERY=true

# E-core CPU range (adjust for your specific CPU)
ECORE_CPU_START=8
ECORE_CPU_END=15

# ----------------------------------------------------------------------------
# INTEL GPU SETTINGS
# ----------------------------------------------------------------------------

# Intel GPU max frequency on AC (MHz)
AC_GPU_MAX_FREQ=1300

# Intel GPU max frequency on battery (MHz)
BATTERY_GPU_MAX_FREQ=900

# Intel GPU boost frequency on AC (MHz)
AC_GPU_BOOST_FREQ=1300

# Intel GPU boost frequency on battery (MHz)
BATTERY_GPU_BOOST_FREQ=900

# Intel GPU minimum frequency (MHz)
GPU_MIN_FREQ=100

# ----------------------------------------------------------------------------
# POWER LIMITS (Intel RAPL via intel-undervolt)
# ----------------------------------------------------------------------------

# PL2 (Short/Burst) power limit in Watts - AC
AC_PL2=45

# PL1 (Long/Sustained) power limit in Watts - AC
AC_PL1=28

# PL2 (Short/Burst) power limit in Watts - Battery
BATTERY_PL2=20

# PL1 (Long/Sustained) power limit in Watts - Battery
BATTERY_PL1=15

# ----------------------------------------------------------------------------
# DISPLAY SETTINGS
# ----------------------------------------------------------------------------

# Enable automatic resolution switching based on power state
AUTO_RESOLUTION_SWITCH=true

# Battery mode resolution
BATTERY_RESOLUTION="1920x1200"
BATTERY_SCALE="1.5x1.5"

# AC mode resolution (native)
AC_RESOLUTION="2880x1800"
AC_SCALE="1x1"

# Auto-brightness using ALS sensor (if available)
AUTO_BRIGHTNESS_ENABLED=true

# Minimum brightness percentage (never go below this)
MIN_BRIGHTNESS_PCT=5

# ----------------------------------------------------------------------------
# MEMORY & SWAP SETTINGS
# ----------------------------------------------------------------------------

# Swappiness (0-200, higher = prefer swap/zram more)
# Use high value with ZRAM for better memory compression
SWAPPINESS=180

# ZRAM compression algorithm (lz4 | zstd | lzo-rle)
ZRAM_ALGORITHM="zstd"

# ZRAM size as percentage of RAM
ZRAM_PERCENT=50

# VFS cache pressure (lower = keep more in cache)
VFS_CACHE_PRESSURE=50

# Dirty writeback interval (centiseconds) - higher = less disk wakeups
DIRTY_WRITEBACK_CS=6000

# Dirty expire (centiseconds)
DIRTY_EXPIRE_CS=6000

# ----------------------------------------------------------------------------
# DEVICE POWER MANAGEMENT
# ----------------------------------------------------------------------------

# Disable webcam driver on battery
DISABLE_WEBCAM_ON_BATTERY=true

# USB autosuspend timeout (seconds, 0 = disabled)
USB_AUTOSUSPEND_DELAY=1

# WiFi power save mode (1 = enabled, 0 = disabled)
# Note: May cause latency issues on some cards
WIFI_POWER_SAVE=0

# Audio codec power save timeout (seconds)
AUDIO_POWER_SAVE_TIMEOUT=10

# PCIe ASPM on battery (default | performance | powersave | powersupersave)
BATTERY_PCIE_ASPM="powersupersave"

# ----------------------------------------------------------------------------
# BLUETOOTH MANAGEMENT
# ----------------------------------------------------------------------------

# Disable bluetooth service at boot (start on-demand)
BLUETOOTH_ON_DEMAND=true

# ----------------------------------------------------------------------------
# NETWORK SETTINGS
# ----------------------------------------------------------------------------

# Disable IPv6 for power savings
DISABLE_IPV6=true

# Enable system-wide ad-blocking via hosts file
ENABLE_HOSTS_ADBLOCK=true

# ----------------------------------------------------------------------------
# KERNEL TUNING
# ----------------------------------------------------------------------------

# Disable NMI watchdog (saves ~0.5W)
DISABLE_NMI_WATCHDOG=true

# Enable laptop mode (aggressive disk power saving)
LAPTOP_MODE=5

# Disable kernel auditing (reduces wakeups)
DISABLE_AUDIT=true

# Enable workqueue power efficiency
WORKQUEUE_POWER_EFFICIENT=true

# ----------------------------------------------------------------------------
# LOGGING & NOTIFICATIONS
# ----------------------------------------------------------------------------

# Log file location
LOG_FILE="/var/log/laptop-power.log"

# Log verbosity (0=errors, 1=info, 2=detailed, 3=debug)
LOG_LEVEL=1

# Desktop notifications on power state change
DESKTOP_NOTIFICATIONS=true

# ----------------------------------------------------------------------------
# PROCESS MANAGEMENT (via ananicy-cpp)
# ----------------------------------------------------------------------------

# Enable ananicy-cpp for automatic process niceness
ENABLE_ANANICY=true

# Browser processes to lower priority on battery
BROWSER_PROCESSES="vivaldi chrome firefox chromium"

# Editor processes to lower priority on battery
EDITOR_PROCESSES="code antigravity"
